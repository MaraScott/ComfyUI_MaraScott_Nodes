const d={async setPrompts(a){const t=(Array.isArray(a.graph.links)?a.graph.links:Object.values(a.graph.links)).find(c=>(c==null?void 0:c.id)==a.inputs[0].link);if(t!=null){const c=a.widgets.find(i=>i.name==="refresh_prompts"),o=a.widgets.find(i=>i.name==="tiles_to_process"),p=a.widgets.find(i=>i.name==="positive"),s=a.widgets.find(i=>i.name==="negative"),n=async i=>{try{const l=await fetch("/marascott/McBoaty_v6/get_prompts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tiles:i,parentId:t.origin_id})});if(l.ok){const m=await l.json();return console.debug("Fetched prompts:",m),m}else return console.error(`Failed to fetch prompts: ${l.status}`),[]}catch(l){return console.error("Error fetching prompts",l),[]}},r=async()=>{p.value,s.value;const i=o!=null?o.value:"",l=await n(i);p.value==""&&(p.value=l.positive),s.value==""&&(s.value=l.negative),setTimeout(()=>{c.value=!1},50)},u=async()=>{c.value=!0,r()};o!=null&&(o.callback=u),c.callback=r,await(async()=>{})(),await u()}},async setModels(a){const e=a.widgets.find(s=>s.name==="ollama_url"),t=a.widgets.find(s=>s.name==="vlm_model"),c=async s=>{try{const n=await fetch("/marascott/ollama/get_models",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:s})});if(n.ok){const r=await n.json();return console.debug("Fetched models:",r),r}else return console.error(`Failed to fetch models: ${n.status}`),[]}catch(n){return console.error("Error fetching models",n),[]}},o=async()=>{const s=e.value,n=t.value;t.value="",t.options.values=[];const r=await c(s);t.options.values=r,console.debug("Updated modelWidget.options.values:",t.options.values),r.includes(n)?t.value=n:r.length>0&&(t.value=r[0]),console.debug("Updated modelWidget.value:",t.value)};e.callback=o,await(async()=>{})(),await o()}},g=a=>({name:"ComfyUI.MaraScott.McBoaty_v6",async loadedGraphNode(e,t){["MaraScottMcBoatyTilePrompter_v6","MaraScottUntiler_v1"].includes(e.type)&&d.setPrompts(e)},async beforeRegisterNodeDef(e,t,c){if(["MaraScottMcBoatyConfigurator_v6","MaraScottMcBoaty_v6"].includes(t.name)){const o=e.prototype.onNodeCreated;e.prototype.onNodeCreated=async function(){o&&o.apply(this,arguments),d.setModels(this)}}if(["MaraScottMcBoatyTilePrompter_v6"].includes(t.name)){const o=e.prototype.onConnectionsChange;e.prototype.onConnectionsChange=async function(s,n,r,u,f){o&&o.apply(this,arguments),d.setPrompts(this)};const p=e.prototype.onExecuted;e.prototype.onExecuted=function(s){p&&(p.apply(this,arguments),d.setPrompts(this))}}}});export{g as MaraScottMcBoaty_v6};
