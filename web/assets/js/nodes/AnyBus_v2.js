import{setAnyBusState as p,useAnyBusState as N}from"./AnyBus_v2/State.js";import{ensureReactGlobals as w,mountJSX as x}from"./AnyBus_v2/React.js";import{getActiveGraph as C}from"./AnyBus_v2/Graph.js";import{A as _,i as F,a as $}from"./ms_chunks/Node.js";function P(){p(t=>({...t,sync:(t.sync||0)+1}))}const A="Comfy.MaraScott.AnyBus_v2",B=A.replace(/\./g,"-");function d({text:t,kind:a="default"}){const u=a==="warn"?"#f59e0b22":a==="ok"?"#16a34a22":"#6b728022",r=a==="warn"?"#f59e0b":a==="ok"?"#16a34a":"#6b7280";return globalThis.React.createElement(globalThis.React.Fragment,null,globalThis.React.createElement("span",{style:{display:"inline-block",padding:"2px 8px",marginRight:6,marginBottom:6,fontSize:12,borderRadius:999,background:u,border:"1px solid "+r}},t))}const L=()=>({name:A,aboutPageBadges:[{label:"Website - MaraScott",url:"https://www.marascott.ai/",icon:"pi pi-home"},{label:"Donate - MaraScott",url:"https://github.com/sponsors/MaraScott",icon:"pi pi-heart"},{label:"GitHub - MaraScott",url:"https://github.com/MaraScott/ComfyUI_MaraScott_Nodes",icon:"pi pi-github"}],bottomPanelTabs:[{id:B,title:"MaraScott Flows",type:"custom",render:async t=>{await w();function a(){return globalThis.React.createElement(globalThis.React.Fragment,null,globalThis.React.createElement("div",null,"Mara Scott"))}t.innerHTML="",x(t,globalThis.React.createElement(a,null))}}],async beforeRegisterNodeDef(t,a,u){if(t.comfyClass===_){const r=t.prototype.onNodeCreated;r==null||r.apply(this,arguments),t.prototype.onNodeCreated=function(){globalThis.console.log("TEST",this.addWidget),globalThis.console.log("TEST2",this.addProperty),F(this),$(this)};const m=t.prototype.onConnectionsChange;m==null||m.apply(this,arguments),t.prototype.onConnectionsChange=function(h,b,n,s,e){this.graph&&P()}}},async setup(){console.log("[AnyBus_v2] extension setup complete")}}),U=()=>({id:B,icon:"mdi mdi-vector-polyline",title:"Any Bus",tooltip:"Any Bus Dashboard",type:"custom",render:async t=>{await w();const a=globalThis.React;function u(){const[r,m]=a.useState({flows:[],totalFlows:0,nodesCount:0,nodes:[],last:0}),[h]=N(),b=a.useCallback(()=>{const n=C();if(!n){m({flows:[],total:0,scanned:0,last:Date.now()}),p(g=>({...g,flows:{start:[],list:[],end:[]},nodes:{}}));return}const s=collectAnyBusByProfile(n),e=[],c=new Set,o=new Set,T=new Set,f={};let R=0;for(const[g,E]of s.entries()){R+=E.length;const y=chainsForProfile(E,n).map((i,M)=>{const S=[];for(let l=0;l<i.length-1;l++){const k=busEdgeInfo(n,i[l],i[l+1]);S.push({from:i[l],to:i[l+1],linkId:k.id,valid:k.valid})}const v={};for(const l of i)v[l.id]=summarizeSlots(l),o.add(l.id),f[l.id]={id:l.id,title:l.title||`Node #${l.id}`};return i.length&&(c.add(i[0].id),T.add(i[i.length-1].id)),{nodes:i,edges:S,slotSummaries:v,index:M+1}});e.push({profile:g,count:y.length,chains:y})}m({flows:e,total:e.length,scanned:R,last:Date.now()}),p(g=>({...g,flows:{start:Array.from(c),list:Array.from(o),end:Array.from(T)},nodes:f}))},[]);return a.useEffect(()=>{b()},[h.sync,b]),globalThis.React.createElement(globalThis.React.Fragment,null,globalThis.React.createElement("div",null,globalThis.React.createElement("div",null,globalThis.React.createElement("strong",null,"AnyBus State"),globalThis.React.createElement("pre",null,JSON.stringify(h,null,2))),globalThis.React.createElement("div",null,globalThis.React.createElement("strong",null,"AnyBus Flows"),globalThis.React.createElement(d,{text:`${r.total} flow(s)`,kind:r.total?"ok":"warn"}),globalThis.React.createElement(d,{text:`${r.scanned} node(s)`}),globalThis.React.createElement("div",null),globalThis.React.createElement("button",{onClick:b,style:{padding:"2px 8px",cursor:"pointer"}},"Refresh")),r.flows.map(n=>globalThis.React.createElement("details",{key:n.profile,open:!0},globalThis.React.createElement("summary",null,globalThis.React.createElement("span",null,"Profile: "),globalThis.React.createElement("strong",null,n.profile)," ",globalThis.React.createElement(d,{text:`${n.count} chain(s)`})),n.chains.map(s=>globalThis.React.createElement("div",{key:n.profile+"_chain_"+s.index},globalThis.React.createElement("div",null,s.nodes.map((e,c)=>globalThis.React.createElement(a.Fragment,{key:e.id+"_frag"},globalThis.React.createElement(d,{text:e.title||`Node #${e.id}`}),c<s.nodes.length-1&&globalThis.React.createElement("span",null,"→")))),globalThis.React.createElement("div",null,globalThis.React.createElement("div",null,"Links"),s.edges.length===0?globalThis.React.createElement("div",null,"No BUS edges."):s.edges.map((e,c)=>{var o;return globalThis.React.createElement("div",{key:c},globalThis.React.createElement("span",null,e.from.title||e.from.id," → ",e.to.title||e.to.id),globalThis.React.createElement(d,{text:`id: ${(o=e.linkId)!=null?o:"n/a"}`,kind:e.valid?"ok":"warn"}))})),globalThis.React.createElement("details",null,globalThis.React.createElement("summary",null,"Slots"),s.nodes.map(e=>{var c;return globalThis.React.createElement("div",{key:"slots_"+e.id},globalThis.React.createElement("div",null,e.title||`Node #${e.id}`),((c=s.slotSummaries[e.id])!=null?c:[]).length===0?globalThis.React.createElement("div",null,"No input slots."):globalThis.React.createElement("div",null,s.slotSummaries[e.id].map(o=>globalThis.React.createElement("div",{key:e.id+"_s_"+o.slot},globalThis.React.createElement(d,{text:`#${o.slot}`}),globalThis.React.createElement(d,{text:o.name||"(unnamed)"}),globalThis.React.createElement(d,{text:o.type||"*"}),globalThis.React.createElement(d,{text:o.linked?"linked":"free",kind:o.linked?"ok":"default"})))))}))))))))}t.innerHTML="",x(t,globalThis.React.createElement(u,null))}});export{L as MaraScottAnyBusNodeExtension,U as MaraScottAnyBusNodeSidebarTab};
